define("block_newgu_spdetails/coursetabs",["exports","core/log","../../../../lib/amd/src/ajax","core/notification","core/templates"],(function(_exports,Log,Ajax,_notification,_templates){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Log=_interopRequireWildcard(Log),Ajax=_interopRequireWildcard(Ajax),_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};const loadAssessments=function(activetab,page,sortby,sortorder,isPageClicked){let subcategory=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,containerBlock=document.querySelector("#course_contents_container"),whichTemplate=null===subcategory?"coursecategory":"coursesubcategory";containerBlock.children.length>0&&(containerBlock.innerHTML=""),containerBlock.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border m-5' role='status'><span class='hidden'>Loading...</span></div></div>");let promise=Ajax.call([{methodname:"block_newgu_spdetails_get_assessments",args:{activetab:activetab,page:page,sortby:sortby,sortorder:sortorder,subcategory:subcategory}}]);promise[0].done((function(response){document.querySelector(".loader").remove();let coursedata=JSON.parse(response.result);Log.debug("coursedata struct:"+response.result+" len:"+response.result.length),_templates.default.renderForPromise("block_newgu_spdetails/"+whichTemplate,{data:coursedata}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(containerBlock,html,js),1==isPageClicked&&containerBlock.scrollIntoView({behavior:"smooth"});let subCategories=document.querySelectorAll(".subcategory-row"),sortColumns=document.querySelectorAll(".th-sortable");subCategoryEventHandler(subCategories),subCategoryReturnHandler(coursedata.parent),sortingEventHandler(sortColumns,activetab,page,subcategory),sortingStatus(sortby,sortorder),sessionStorage.setItem("activeTab",activetab),subcategory?(sessionStorage.setItem("activeCategoryId",subcategory),document.querySelector("#courseNav-container").classList.add("hidden-container")):(sessionStorage.removeItem("activeCategoryId"),document.querySelector("#courseNav-container").classList.remove("hidden-container"))})).catch((error=>(0,_notification.exception)(error)))})).fail((function(response){if(response){document.querySelector(".loader").remove();let errorContainer=document.createElement("div");if(errorContainer.classList.add("alert","alert-danger"),response.hasOwnProperty("message")){let errorMsg=document.createElement("p");errorMsg.innerHTML=response.message,errorContainer.appendChild(errorMsg),errorMsg.classList.add("errormessage")}if(response.hasOwnProperty("moreinfourl")){let errorLinkContainer=document.createElement("p"),errorLink=document.createElement("a");errorLink.setAttribute("href",response.moreinfourl),errorLink.setAttribute("target","_blank"),errorLink.innerHTML="More information about this error",errorContainer.appendChild(errorLinkContainer),errorLinkContainer.appendChild(errorLink),errorLinkContainer.classList.add("errorcode")}containerBlock.prepend(errorContainer)}}))},subCategoryEventHandler=rows=>{rows.length>0&&rows.forEach((element=>{element.addEventListener("click",(()=>showSubcategoryDetails(element)))}))},showSubcategoryDetails=object=>{let id=object.parentElement.getAttribute("data-id");if(null!==id){document.querySelector("#courseNav-container").classList.add("hidden-container");let activetab="";activetab=document.querySelector("#current_tab").classList.contains("active")?"current":"past",loadAssessments(activetab,0,"duedate","asc",!0,id)}},subCategoryReturnHandler=id=>{Log.debug("subCategoryReturnHandler called with id:"+id),document.querySelector("#subcategory-return-assessment")&&document.querySelector("#subcategory-return-assessment").addEventListener("click",(()=>{Log.debug("calling loadAssessments with id:"+id),0!=id&&null!==id||(id=null,document.querySelector("#courseNav-container").classList.remove("hidden-container"));let activetab="";activetab=document.querySelector("#current_tab").classList.contains("active")?"current":"past",loadAssessments(activetab,0,"shortname","asc",!0,id)}))},sortingEventHandler=(rows,activetab,page,subcategory)=>{rows.length>0&&rows.forEach((element=>{element.addEventListener("click",(()=>sortingHeaders(element,activetab,page,subcategory)))}))},sortingHeaders=(object,activetab,page,subcategory)=>{let sortby=object.getAttribute("data-sortby"),sortorder=object.getAttribute("data-value");null===sortorder&&(sortorder="asc"),null!==sortorder&&(sortorder="asc"==sortorder?"desc":"asc"),loadAssessments(activetab,page,sortby,sortorder,!0,subcategory)},sortingStatus=function(sortby,sortorder){Log.debug("sortingStatus called with sortby:"+sortby+" sortorder:"+sortorder);let sortByShortName=document.querySelector("#sortby_shortname"),sortByFullName=document.querySelector("#sortby_fullname"),sortByAssessmentType=document.querySelector("#sortby_assessmenttype"),sortByWeight=document.querySelector("#sortby_weight"),sortByDueDate=document.querySelector("#sortby_duedate"),sortByStatus=document.querySelector("#sortby_status"),sortByGrade=document.querySelector("#sortby_grade");switch(sortby){case"shortname":sortByShortName&&("asc"==sortorder?(sortByShortName.classList.add("th-sort-asc"),sortByShortName.classList.remove("th-sort-desc"),sortByShortName.setAttribute("data-value","asc")):(sortByShortName.classList.add("th-sort-desc"),sortByShortName.classList.remove("th-sort-asc"),sortByShortName.setAttribute("data-value","desc")));break;case"fullname":sortByFullName&&("asc"==sortorder?(sortByFullName.classList.add("th-sort-asc"),sortByFullName.classList.remove("th-sort-desc"),sortByFullName.setAttribute("data-value","asc")):(sortByFullName.classList.add("th-sort-desc"),sortByFullName.classList.remove("th-sort-asc"),sortByFullName.setAttribute("data-value","desc")));break;case"assessmenttype":sortByAssessmentType&&("asc"==sortorder?(sortByAssessmentType.classList.add("th-sort-asc"),sortByAssessmentType.classList.remove("th-sort-desc"),sortByAssessmentType.setAttribute("data-value","asc")):(sortByAssessmentType.classList.add("th-sort-desc"),sortByAssessmentType.classList.remove("th-sort-asc"),sortByAssessmentType.setAttribute("data-value","desc")));break;case"weight":sortByWeight&&("asc"==sortorder?(sortByWeight.classList.add("th-sort-asc"),sortByWeight.classList.remove("th-sort-desc"),sortByWeight.setAttribute("data-value","asc")):(sortByWeight.classList.add("th-sort-desc"),sortByWeight.classList.remove("th-sort-asc"),sortByWeight.setAttribute("data-value","desc")));break;case"duedate":sortByDueDate&&("asc"==sortorder?(sortByDueDate.classList.add("th-sort-asc"),sortByDueDate.classList.remove("th-sort-desc"),sortByDueDate.setAttribute("data-value","asc")):(sortByDueDate.classList.add("th-sort-desc"),sortByDueDate.classList.remove("th-sort-asc"),sortByDueDate.setAttribute("data-value","desc")));break;case"status":sortByStatus&&("asc"==sortorder?(sortByStatus.classList.add("th-sort-asc"),sortByStatus.classList.remove("th-sort-desc"),sortByStatus.setAttribute("data-value","asc")):(sortByStatus.classList.add("th-sort-desc"),sortByStatus.classList.remove("th-sort-asc"),sortByStatus.setAttribute("data-value","desc")));break;case"grade":sortByGrade&&("asc"==sortorder?(sortByGrade.classList.add("th-sort-asc"),sortByGrade.classList.remove("th-sort-desc"),sortByGrade.setAttribute("data-value","asc")):(sortByGrade.classList.add("th-sort-desc"),sortByGrade.classList.remove("th-sort-asc"),sortByGrade.setAttribute("data-value","desc")))}},handleTabChange=function(event){event.preventDefault();let currentTab=document.querySelector("#current_tab"),pastTab=document.querySelector("#past_tab"),activetab="";switch(event.target){case currentTab:activetab="current",currentTab.classList.add("active"),pastTab.classList.remove("active");break;case pastTab:activetab="past",currentTab.classList.remove("active"),pastTab.classList.add("active")}loadAssessments(activetab,0,"shortname","asc",!1)};_exports.init=()=>{(()=>{let activetab="current",isPageClicked=!1,subcatId=null,activeTab=sessionStorage.getItem("activeTab"),activeCategoryId=sessionStorage.getItem("activeCategoryId");if(activeTab){Log.debug("activetab:",activetab),activetab=activeTab;let currentTab=document.querySelector("#current_tab"),pastTab=document.querySelector("#past_tab");switch(activetab){case"current":currentTab.classList.add("active"),pastTab.classList.remove("active");break;case"past":currentTab.classList.remove("active"),pastTab.classList.add("active")}}activeCategoryId&&(Log.debug("activeCategoryId:",activeCategoryId),subcatId=activeCategoryId,isPageClicked=!0),loadAssessments(activetab,0,"shortname","asc",isPageClicked,subcatId),document.querySelectorAll("#courses-Tab button").forEach((triggerEl=>{triggerEl.addEventListener("click",handleTabChange),triggerEl.addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&element.hasAttribute("tabindex")&&(event.preventDefault(),element.click())}))}))})()}}));

//# sourceMappingURL=coursetabs.min.js.map