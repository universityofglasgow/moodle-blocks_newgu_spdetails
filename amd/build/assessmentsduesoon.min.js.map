{"version":3,"file":"assessmentsduesoon.min.js","sources":["../src/assessmentsduesoon.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Assessments due soon section\n *\n * @module     block_newgu_spdetails/assessmentsduesoon\n * @author     Greg Pedder <greg.pedder@glasgow.ac.uk>\n * @copyright  2024 University of Glasgow\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport * as Log from 'core/log';\nimport * as ajax from 'core/ajax';\nimport {Chart, BarController} from 'core/chartjs';\n\nconst Selectors = {\n    DUESOON_BLOCK: '#assessmentsDueSoonContainer',\n};\n\n/**\n * @method fetchAssessmentsDueSoon\n */\nconst fetchAssessmentsDueSoon = () => {\n    Chart.register(BarController);\n    let tempPanel = document.querySelector(Selectors.DUESOON_BLOCK);\n\n    tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='loader d-flex justify-content-center'>\\n\" +\n        \"<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>\");\n\n    ajax.call([{\n        methodname: 'block_newgu_spdetails_get_assessmentsduesoon',\n        args: {},\n    }])[0].done(function(response) {\n        document.querySelector('.loader').remove();\n        Log.debug('response is:' + response[0]['24hours']);\n        tempPanel.insertAdjacentHTML(\"afterbegin\", \"<canvas id='assessmentsDueSoonChart'\\n\" +\n            \" aria-label='Assessments Due Soon chart data' role='graphics-object'>\\n\" +\n            \"<p>The &lt;canvas&gt; element appears to be unsupported in your browser.</p>\\n\" +\n            \"</canvas>\");\n\n        const data = [\n            {\n                labeltitle: `24 hours:`,\n                value: response[0]['24hours']\n            },\n            {\n                labeltitle: `7 days:`,\n                value: response[0]['week']\n            },\n            {\n                labeltitle: `month:`,\n                value: response[0]['month']\n            }\n        ];\n\n\n        new Chart(\n            document.getElementById('assessmentsDueSoonChart'),\n            {\n                type: 'bar',\n                options: {\n                    responsive: true,\n                    indexAxis: 'y',\n                    scales: {\n                        x: {\n                            suggestedMin: 1,\n                            suggestedMax: 10\n                        }\n                    },\n                    plugins: {\n                        legend: {\n                            display: true,\n                            position: 'top',\n                            labels: {\n                                usePointStyle: true,\n                                font: {\n                                    size: 20\n                                },\n                                generateLabels: (chart) => {\n                                    const datasets = chart.data.datasets;\n                                    return datasets[0].data.map((data, i) => ({\n                                        text: `${chart.data.labels[i]} ${data}`,\n                                        fillStyle: datasets[0].backgroundColor[i],\n                                        strokeStyle: datasets[0].backgroundColor[i],\n                                        pointStyle: 'rectRounded',\n                                        index: i\n                                    }));\n                                }\n                            },\n                        }\n                    },\n                },\n                data: {\n                    datasets: [{\n                        indexAxis: 'y',\n                        data: data.map(row => row.value),\n                        backgroundColor: [\n                            'rgba(255,0,0,0.6)',\n                            'rgba(255,153,0,0.6)',\n                            'rgba(0,153,0,0.6)'\n                        ],\n                        borderColor: [\n                            'rgba(255,0,0)',\n                            'rgba(255,153,0)',\n                            'rgba(0,153,0)'\n                        ],\n                        borderWidth: 1,\n                        hoverOffset: 4\n                    }],\n                    labels: data.map(row => row.labeltitle),\n                }\n            }\n        );\n\n    }).fail(function(err) {\n        document.querySelector('.loader').remove();\n        tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='d-flex justify-content-center'>\\n\" +\n            err.message + \"</div>\");\n        Log.debug(err);\n    });\n};\n\n/**\n * @constructor\n */\nexport const init = () => {\n    fetchAssessmentsDueSoon();\n};"],"names":["Selectors","register","BarController","tempPanel","document","querySelector","insertAdjacentHTML","ajax","call","methodname","args","done","response","remove","Log","debug","data","labeltitle","value","Chart","getElementById","type","options","responsive","indexAxis","scales","x","suggestedMin","suggestedMax","plugins","legend","display","position","labels","usePointStyle","font","size","generateLabels","chart","datasets","map","i","text","fillStyle","backgroundColor","strokeStyle","pointStyle","index","row","borderColor","borderWidth","hoverOffset","fail","err","message","fetchAssessmentsDueSoon"],"mappings":"wtCA8BMA,wBACa,6CA6GC,KAvGY,qBACtBC,SAASC,4BACXC,UAAYC,SAASC,cAAcL,yBAEvCG,UAAUG,mBAAmB,aAAa,oJAG1CC,KAAKC,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,MACN,GAAGC,MAAK,SAASC,UACjBR,SAASC,cAAc,WAAWQ,SAClCC,IAAIC,MAAM,eAAiBH,SAAS,GAAG,YACvCT,UAAUG,mBAAmB,aAAc,8MAKrCU,KAAO,CACT,CACIC,WAAa,YACbC,MAAON,SAAS,GAAG,YAEvB,CACIK,WAAa,UACbC,MAAON,SAAS,GAAT,MAEX,CACIK,WAAa,SACbC,MAAON,SAAS,GAAT,YAKXO,eACAf,SAASgB,eAAe,2BACxB,CACIC,KAAM,MACNC,QAAS,CACLC,YAAY,EACZC,UAAW,IACXC,OAAQ,CACJC,EAAG,CACCC,aAAc,EACdC,aAAc,KAGtBC,QAAS,CACLC,OAAQ,CACJC,SAAS,EACTC,SAAU,MACVC,OAAQ,CACJC,eAAe,EACfC,KAAM,CACFC,KAAM,IAEVC,eAAiBC,cACPC,SAAWD,MAAMtB,KAAKuB,gBACrBA,SAAS,GAAGvB,KAAKwB,KAAI,CAACxB,KAAMyB,MAC/BC,KAAO,GAAEJ,MAAMtB,KAAKiB,OAAOQ,MAAMzB,OACjC2B,UAAWJ,SAAS,GAAGK,gBAAgBH,GACvCI,YAAaN,SAAS,GAAGK,gBAAgBH,GACzCK,WAAY,cACZC,MAAON,WAO/BzB,KAAM,CACFuB,SAAU,CAAC,CACPf,UAAW,IACXR,KAAMA,KAAKwB,KAAIQ,KAAOA,IAAI9B,QAC1B0B,gBAAiB,CACb,oBACA,sBACA,qBAEJK,YAAa,CACT,gBACA,kBACA,iBAEJC,YAAa,EACbC,YAAa,IAEjBlB,OAAQjB,KAAKwB,KAAIQ,KAAOA,IAAI/B,mBAKzCmC,MAAK,SAASC,KACbjD,SAASC,cAAc,WAAWQ,SAClCV,UAAUG,mBAAmB,aAAa,gDACtC+C,IAAIC,QAAU,UAClBxC,IAAIC,MAAMsC,SAQdE"}