define("block_newgu_spdetails/assessmentsduesoon",["exports","core/log","core/ajax","core/chartjs","core/notification","core/templates"],(function(_exports,Log,ajax,_chartjs,_notification,_templates){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Log=_interopRequireWildcard(Log),ajax=_interopRequireWildcard(ajax),_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};const Selectors_DUESOON_BLOCK="#assessmentsDueSoonContainer",Selectors_COURSECONTENTS_BLOCK="#courseTab-container",Selectors_ASSESSMENTSDUE_BLOCK="#assessmentsDue-container",Selectors_ASSESSMENTSDUE_CONTENTS="#assessmentsdue_content",viewAssessmentsDueByChartType=function(chartItem,legendItem){const chartType=legendItem?legendItem.datasetIndex:chartItem;let containerBlock=document.querySelector(Selectors_COURSECONTENTS_BLOCK);containerBlock.checkVisibility()&&containerBlock.classList.add("hidden-container");let assessmentsDueBlock=document.querySelector(Selectors_ASSESSMENTSDUE_BLOCK),assessmentsDueContents=document.querySelector(Selectors_ASSESSMENTSDUE_CONTENTS);assessmentsDueBlock.children.length>0&&(assessmentsDueContents.innerHTML=""),assessmentsDueBlock.classList.remove("hidden-container"),assessmentsDueContents.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>"),ajax.call([{methodname:"block_newgu_spdetails_get_assessmentsduebytype",args:{charttype:chartType}}])[0].done((function(response){document.querySelector(".loader").remove();let assessmentdata=JSON.parse(response.result);_templates.default.renderForPromise("block_newgu_spdetails/assessmentsdue",{data:assessmentdata}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(assessmentsDueContents,html,js),returnToAssessmentsHandler()})).catch((error=>(0,_notification.exception)(error)))})).fail((function(response){if(response){document.querySelector(".loader").remove();let errorContainer=document.createElement("div");if(errorContainer.classList.add("alert","alert-danger"),response.hasOwnProperty("message")){let errorMsg=document.createElement("p");errorMsg.innerHTML=response.message,errorContainer.appendChild(errorMsg),errorMsg.classList.add("errormessage")}if(response.hasOwnProperty("moreinfourl")){let errorLinkContainer=document.createElement("p"),errorLink=document.createElement("a");errorLink.setAttribute("href",response.moreinfourl),errorLink.setAttribute("target","_blank"),errorLink.innerHTML="More information about this error",errorContainer.appendChild(errorLinkContainer),errorLinkContainer.appendChild(errorLink),errorLinkContainer.classList.add("errorcode")}assessmentsDueContents.prepend(errorContainer)}}))},returnToAssessmentsHandler=()=>{document.querySelector("#assessments-due-return")&&(document.querySelector("#assessments-due-return").addEventListener("click",(()=>{let containerBlock=document.querySelector(Selectors_COURSECONTENTS_BLOCK);document.querySelector(Selectors_ASSESSMENTSDUE_BLOCK).classList.add("hidden-container"),containerBlock.classList.remove("hidden-container")})),document.querySelector("#assessments-due-return").addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&element.hasAttribute("tabindex")&&(event.preventDefault(),element.click())})))};_exports.init=()=>{(()=>{_chartjs.Chart.register(_chartjs.BarController);let tempPanel=document.querySelector(Selectors_DUESOON_BLOCK);tempPanel.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>"),ajax.call([{methodname:"block_newgu_spdetails_get_assessmentsduesoon",args:{}}])[0].done((function(response){document.querySelector(".loader").remove(),tempPanel.insertAdjacentHTML("afterbegin","<canvas id='assessmentsDueSoonChart'\n aria-label='Assessments Due Soon chart data' role='graphics-object'>\n<p>The &lt;canvas&gt; element appears to be unsupported in your browser.</p>\n</canvas>");const data=[{labeltitle:"24 hours:",value:response[0]["24hours"]},{labeltitle:"7 days:",value:response[0].week},{labeltitle:"month:",value:response[0].month}],ctx=document.getElementById("assessmentsDueSoonChart"),chart=new _chartjs.Chart(ctx,{type:"bar",options:{responsive:!0,indexAxis:"y",onHover:(event,chartElement)=>{event.native.target.style.cursor=chartElement[0]?"pointer":"default"},scales:{x:{suggestedMin:1,suggestedMax:10}},plugins:{legend:{display:!0,position:"top",onClick:viewAssessmentsDueByChartType,onHover:event=>{event.native.target.style.cursor="pointer"},onLeave:event=>{event.native.target.style.cursor="default"},labels:{usePointStyle:!0,font:{size:20},generateLabels:chart=>{const datasets=chart.data.datasets;return datasets[0].data.map(((data,i)=>({text:`${chart.data.labels[i]} ${data}`,borderRadius:0,datasetIndex:i,fillStyle:datasets[0].backgroundColor[i],fontColor:"",hidden:!1,lineCap:"",lineDash:[],lineDashOffset:0,lineJoin:"",lineWidth:0,strokeStyle:datasets[0].backgroundColor[i],pointStyle:"rectRounded",rotation:0,index:i})))}}}}},data:{labels:data.map((row=>row.labeltitle)),datasets:[{data:data.map((row=>row.value)),indexAxis:"y",backgroundColor:["rgba(255,0,0,0.6)","rgba(255,153,0,0.6)","rgba(0,153,0,0.6)"],borderColor:["rgba(255,0,0)","rgba(255,153,0)","rgba(0,153,0)"],borderWidth:1,hoverOffset:4}]}});document.getElementById("assessmentsDueSoonChart").onclick=evt=>{const points=chart.getElementsAtEventForMode(evt,"nearest",{intersect:!0},!0);0!==points.length&&viewAssessmentsDueByChartType(points[0].index)}})).fail((function(err){document.querySelector(".loader").remove(),tempPanel.insertAdjacentHTML("afterbegin","<div class='d-flex justify-content-center'>\n"+err.message+"</div>"),Log.debug(err)}))})()}}));

//# sourceMappingURL=assessmentsduesoon.min.js.map