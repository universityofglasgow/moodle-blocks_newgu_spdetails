{"version":3,"file":"assessmentsummary.min.js","sources":["../src/assessmentsummary.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Assessment Summary section\n *\n * @module     block_newgu_spdetails/summary\n * @author     Greg Pedder <greg.pedder@glasgow.ac.uk>\n * @copyright  2023 University of Glasgow\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport * as Log from 'core/log';\nimport * as ajax from 'core/ajax';\nimport {Chart, DoughnutController} from 'core/chartjs';\n\nconst Selectors = {\n    SUMMARY_BLOCK: '#assessmentSummaryContainer',\n};\n\n/**\n * @method fetchAssessmentSummary\n */\nconst fetchAssessmentSummary = () => {\n    Chart.register(DoughnutController);\n    let tempPanel = document.querySelector(Selectors.SUMMARY_BLOCK);\n\n    tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='loader d-flex justify-content-center'>\\n\" +\n        \"<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>\");\n\n    ajax.call([{\n        methodname: 'block_newgu_spdetails_get_assessmentsummary',\n        args: {},\n    }])[0].done(function(response) {\n        document.querySelector('.loader').remove();\n        Log.debug('response is:' + response[0]['sub_assess']);\n        tempPanel.insertAdjacentHTML(\"afterbegin\", \"<canvas id='assessmentSummaryChart'\\n\" +\n            \" aria-label='Assessment Summary chart data' role='graphics-object'>\\n\" +\n            \"<p>The &lt;canvas&gt; element appears to be unsupported in your browser.</p>\\n\" +\n            \"</canvas>\");\n\n        const data = [\n            {\n                labeltitle: `Submitted`,\n                value: response[0]['sub_assess']\n            },\n            {\n                labeltitle: `To be submitted`,\n                value: response[0]['tobe_sub']\n            },\n            {\n                labeltitle: `Overdue`,\n                value: response[0]['overdue']\n            },\n            {\n                labeltitle: `Marked`,\n                value: response[0]['assess_marked']\n            },\n        ];\n\n\n        new Chart(\n            document.getElementById('assessmentSummaryChart'),\n            {\n                type: 'doughnut',\n                options: {\n                    responsive: true,\n                    plugins: {\n                        legend: {\n                            display: true,\n                            position: 'right',\n                            labels: {\n                                usePointStyle: true,\n                                font: {\n                                    size: 20\n                                },\n                                generateLabels: (chart) => {\n                                    const datasets = chart.data.datasets;\n                                    return datasets[0].data.map((data, i) => ({\n                                        text: `${chart.data.labels[i]} ${data}`,\n                                        fillStyle: datasets[0].backgroundColor[i],\n                                        strokeStyle: datasets[0].backgroundColor[i],\n                                        pointStyle: 'rectRounded',\n                                        index: i\n                                    }));\n                                }\n                            },\n                        }\n                    },\n                    radius: '100%',\n                    maintainAspectRatio: false\n                },\n                data: {\n                    datasets: [{\n                        data: data.map(row => row.value),\n                        backgroundColor: [\n                            '#058',\n                            '#CC5500',\n                            '#FF0000FF',\n                            '#008000FF'\n                        ],\n                        hoverOffset: 4\n                    }],\n                    labels: data.map(row => row.labeltitle),\n                }\n            }\n        );\n\n    }).fail(function(err) {\n        document.querySelector('.loader').remove();\n        tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='d-flex justify-content-center'>\\n\" +\n            err.message + \"</div>\");\n        Log.debug(err);\n    });\n};\n\n/**\n * @constructor\n */\nexport const init = () => {\n    fetchAssessmentSummary();\n};"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_exports","value","init","Log","ajax","Selectors","fetchAssessmentSummary","Chart","register","DoughnutController","tempPanel","document","querySelector","insertAdjacentHTML","methodname","args","done","response","remove","debug","data","labeltitle","getElementById","type","options","responsive","plugins","legend","display","position","labels","usePointStyle","font","size","generateLabels","chart","datasets","map","i","text","fillStyle","backgroundColor","strokeStyle","pointStyle","index","radius","maintainAspectRatio","row","hoverOffset","fail","err","message"],"mappings":"yIA2BkC,SAAAA,yBAAAC,mCAAAC,wBAAAC,sBAAAD,QAAAE,qBAAAF,eAAAF,kCAAAC,oBAAAA,YAAAG,iBAAAD,oBAAAF,aAAA,SAAAI,wBAAAC,IAAAL,iBAAAA,aAAAK,KAAAA,IAAAC,kBAAAD,cAAAA,sBAAAA,wBAAAA,WAAAE,QAAAF,SAAAG,MAAAT,yBAAAC,gBAAAQ,OAAAA,MAAAC,IAAAJ,YAAAG,MAAAE,IAAAL,SAAAM,UAAAC,sBAAAC,OAAAC,gBAAAD,OAAAE,iCAAAC,OAAAX,mBAAAW,KAAAH,OAAAI,UAAAC,eAAAC,KAAAd,IAAAW,UAAAI,KAAAR,sBAAAC,OAAAE,yBAAAV,IAAAW,UAAAI,OAAAA,KAAAV,KAAAU,KAAAC,KAAAR,OAAAC,eAAAH,OAAAK,IAAAI,MAAAT,OAAAK,KAAAX,IAAAW,YAAAL,OAAAJ,QAAAF,IAAAG,OAAAA,MAAAa,IAAAhB,IAAAM,QAAAA,OAHrBE,OAAAC,eAAAQ,uBAAAC,WAAAD,SAAAE,YAEbC,IAAArB,wBAAAqB,KACAC,KAAAtB,wBAAAsB,MAGA,MAAMC,wBACa,8BAwGjBL,SAAAE,KAFkBA,KAhGWI,MAC3BC,eAAMC,SAASC,6BACf,IAAIC,UAAYC,SAASC,cAAcP,yBAEvCK,UAAUG,mBAAmB,aAAa,oJAG1CT,KAAKP,KAAK,CAAC,CACPiB,WAAY,8CACZC,KAAM,MACN,GAAGC,MAAK,SAASC,UACjBN,SAASC,cAAc,WAAWM,SAClCf,IAAIgB,MAAM,eAAiBF,SAAS,GAAe,YACnDP,UAAUG,mBAAmB,aAAc,qMAK3C,MAAMO,KAAO,CACT,CACIC,WAAa,YACbpB,MAAOgB,SAAS,GAAe,YAEnC,CACII,WAAa,kBACbpB,MAAOgB,SAAS,GAAa,UAEjC,CACII,WAAa,UACbpB,MAAOgB,SAAS,GAAY,SAEhC,CACII,WAAa,SACbpB,MAAOgB,SAAS,GAAkB,gBAK1C,IAAIV,eACAI,SAASW,eAAe,0BACxB,CACIC,KAAM,WACNC,QAAS,CACLC,YAAY,EACZC,QAAS,CACLC,OAAQ,CACJC,SAAS,EACTC,SAAU,QACVC,OAAQ,CACJC,eAAe,EACfC,KAAM,CACFC,KAAM,IAEVC,eAAiBC,QACb,MAAMC,SAAWD,MAAMf,KAAKgB,SAC5B,OAAOA,SAAS,GAAGhB,KAAKiB,KAAI,CAACjB,KAAMkB,MAC/BC,KAAO,GAAEJ,MAAMf,KAAKU,OAAOQ,MAAMlB,OACjCoB,UAAWJ,SAAS,GAAGK,gBAAgBH,GACvCI,YAAaN,SAAS,GAAGK,gBAAgBH,GACzCK,WAAY,cACZC,MAAON,KACR,KAKnBO,OAAQ,OACRC,qBAAqB,GAEzB1B,KAAM,CACFgB,SAAU,CAAC,CACPhB,KAAMA,KAAKiB,KAAIU,KAAOA,IAAI9C,QAC1BwC,gBAAiB,CACb,OACA,UACA,YACA,aAEJO,YAAa,IAEjBlB,OAAQV,KAAKiB,KAAIU,KAAOA,IAAI1B,mBAKzC4B,MAAK,SAASC,KACbvC,SAASC,cAAc,WAAWM,SAClCR,UAAUG,mBAAmB,aAAa,gDACtCqC,IAAIC,QAAU,UAClBhD,IAAIgB,MAAM+B,OACZ,EAOF5C,EAAwB,CAC1B"}