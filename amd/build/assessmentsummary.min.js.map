{"version":3,"file":"assessmentsummary.min.js","sources":["../src/assessmentsummary.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Assessment Summary section\n *\n * @module     block_newgu_spdetails/assessmentsummary\n * @author     Greg Pedder <greg.pedder@glasgow.ac.uk>\n * @copyright  2023 University of Glasgow\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport * as Log from 'core/log';\nimport * as ajax from 'core/ajax';\nimport {Chart, DoughnutController} from 'core/chartjs';\n\nconst Selectors = {\n    SUMMARY_BLOCK: '#assessmentSummaryContainer',\n};\n\n/**\n * @method fetchAssessmentSummary\n */\nconst fetchAssessmentSummary = () => {\n    Chart.register(DoughnutController);\n    let tempPanel = document.querySelector(Selectors.SUMMARY_BLOCK);\n\n    tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='loader d-flex justify-content-center'>\\n\" +\n        \"<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>\");\n\n    ajax.call([{\n        methodname: 'block_newgu_spdetails_get_assessmentsummary',\n        args: {},\n    }])[0].done(function(response) {\n        document.querySelector('.loader').remove();\n        tempPanel.insertAdjacentHTML(\"afterbegin\", \"<canvas id='assessmentSummaryChart'\\n\" +\n            \" aria-label='Assessment Summary chart data' role='graphics-object'>\\n\" +\n            \"<p>The &lt;canvas&gt; element appears to be unsupported in your browser.</p>\\n\" +\n            \"</canvas>\");\n\n        const data = [\n            {\n                labeltitle: `Submitted`,\n                value: response[0]['sub_assess']\n            },\n            {\n                labeltitle: `To be submitted`,\n                value: response[0]['tobe_sub']\n            },\n            {\n                labeltitle: `Overdue`,\n                value: response[0]['overdue']\n            },\n            {\n                labeltitle: `Marked`,\n                value: response[0]['assess_marked']\n            },\n        ];\n\n\n        new Chart(\n            document.getElementById('assessmentSummaryChart'),\n            {\n                type: 'doughnut',\n                options: {\n                    responsive: true,\n                    plugins: {\n                        legend: {\n                            display: true,\n                            position: 'right',\n                            labels: {\n                                usePointStyle: true,\n                                font: {\n                                    size: 20\n                                },\n                                generateLabels: (chart) => {\n                                    const datasets = chart.data.datasets;\n                                    return datasets[0].data.map((data, i) => ({\n                                        text: `${chart.data.labels[i]} ${data}`,\n                                        fillStyle: datasets[0].backgroundColor[i],\n                                        strokeStyle: datasets[0].backgroundColor[i],\n                                        pointStyle: 'rectRounded',\n                                        index: i\n                                    }));\n                                }\n                            },\n                        }\n                    },\n                    radius: '100%',\n                    maintainAspectRatio: false\n                },\n                data: {\n                    datasets: [{\n                        data: data.map(row => row.value),\n                        backgroundColor: [\n                            'rgba(0,153,0)',\n                            'rgba(255,153,0)',\n                            'rgba(255,0,0)',\n                            'rgba(129,187,255)'\n                        ],\n                        hoverOffset: 4\n                    }],\n                    labels: data.map(row => row.labeltitle),\n                }\n            }\n        );\n\n    }).fail(function(err) {\n        document.querySelector('.loader').remove();\n        tempPanel.insertAdjacentHTML(\"afterbegin\",\"<div class='d-flex justify-content-center'>\\n\" +\n            err.message + \"</div>\");\n        Log.debug(err);\n    });\n};\n\n/**\n * @constructor\n */\nexport const init = () => {\n    fetchAssessmentSummary();\n};"],"names":["Selectors","register","DoughnutController","tempPanel","document","querySelector","insertAdjacentHTML","ajax","call","methodname","args","done","response","remove","data","labeltitle","value","Chart","getElementById","type","options","responsive","plugins","legend","display","position","labels","usePointStyle","font","size","generateLabels","chart","datasets","map","i","text","fillStyle","backgroundColor","strokeStyle","pointStyle","index","radius","maintainAspectRatio","row","hoverOffset","fail","err","message","Log","debug","fetchAssessmentSummary"],"mappings":"utCA8BMA,wBACa,4CAqGC,KA/FW,qBACrBC,SAASC,iCACXC,UAAYC,SAASC,cAAcL,yBAEvCG,UAAUG,mBAAmB,aAAa,oJAG1CC,KAAKC,KAAK,CAAC,CACPC,WAAY,8CACZC,KAAM,MACN,GAAGC,MAAK,SAASC,UACjBR,SAASC,cAAc,WAAWQ,SAClCV,UAAUG,mBAAmB,aAAc,2MAKrCQ,KAAO,CACT,CACIC,WAAa,YACbC,MAAOJ,SAAS,GAAT,YAEX,CACIG,WAAa,kBACbC,MAAOJ,SAAS,GAAT,UAEX,CACIG,WAAa,UACbC,MAAOJ,SAAS,GAAT,SAEX,CACIG,WAAa,SACbC,MAAOJ,SAAS,GAAT,oBAKXK,eACAb,SAASc,eAAe,0BACxB,CACIC,KAAM,WACNC,QAAS,CACLC,YAAY,EACZC,QAAS,CACLC,OAAQ,CACJC,SAAS,EACTC,SAAU,QACVC,OAAQ,CACJC,eAAe,EACfC,KAAM,CACFC,KAAM,IAEVC,eAAiBC,cACPC,SAAWD,MAAMjB,KAAKkB,gBACrBA,SAAS,GAAGlB,KAAKmB,KAAI,CAACnB,KAAMoB,MAC/BC,KAAO,GAAEJ,MAAMjB,KAAKY,OAAOQ,MAAMpB,OACjCsB,UAAWJ,SAAS,GAAGK,gBAAgBH,GACvCI,YAAaN,SAAS,GAAGK,gBAAgBH,GACzCK,WAAY,cACZC,MAAON,UAM3BO,OAAQ,OACRC,qBAAqB,GAEzB5B,KAAM,CACFkB,SAAU,CAAC,CACPlB,KAAMA,KAAKmB,KAAIU,KAAOA,IAAI3B,QAC1BqB,gBAAiB,CACb,gBACA,kBACA,gBACA,qBAEJO,YAAa,IAEjBlB,OAAQZ,KAAKmB,KAAIU,KAAOA,IAAI5B,mBAKzC8B,MAAK,SAASC,KACb1C,SAASC,cAAc,WAAWQ,SAClCV,UAAUG,mBAAmB,aAAa,gDACtCwC,IAAIC,QAAU,UAClBC,IAAIC,MAAMH,SAQdI"}