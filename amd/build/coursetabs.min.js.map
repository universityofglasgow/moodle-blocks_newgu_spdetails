{"version":3,"file":"coursetabs.min.js","sources":["../src/coursetabs.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the Course Tabs section\n *\n * @module     block_newgu_spdetails/coursetabs\n * @author     Greg Pedder <greg.pedder@glasgow.ac.uk>\n * @copyright  2023 University of Glasgow\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport * as Log from 'core/log';\nimport * as Ajax from \"../../../../lib/amd/src/ajax\";\nimport {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nconst initCourseTabs = () => {\n\n    let activetab = 'current';\n    let page = 0;\n    let sortby = 'coursetitle';\n    let sortorder = 'ASC';\n    let isPageClicked = false;\n\n    // Load the assessments for the \"current\" tab to begin with...\n    loadAssessments(activetab, page, sortby, sortorder, isPageClicked);\n\n    const triggerTabList = document.querySelectorAll('#courses-Tab button');\n\n    // Bind our event listeners.\n    triggerTabList.forEach(triggerEl => {\n        triggerEl.addEventListener('click', handleTabChange);\n        triggerEl.addEventListener('keyup', function(event) {\n            let element = document.activeElement;\n            if (event.keyCode === 13 && element.hasAttribute('tabindex')) {\n                event.preventDefault();\n                element.click();\n            }\n        });\n    });\n};\n\nconst loadAssessments = function(activetab, page, sortby, sortorder, isPageClicked, subcategory = null) {\n    let containerBlock = document.querySelector('#course_contents_container');\n\n    let whichTemplate = subcategory === null ? 'coursecategory' : 'coursesubcategory';\n\n    if (containerBlock.children.length > 0) {\n        containerBlock.innerHTML = '';\n    }\n\n    containerBlock.insertAdjacentHTML(\"afterbegin\",\"<div class='loader d-flex justify-content-center'>\\n\" +\n    \"<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>\");\n\n    let promise = Ajax.call([{\n        methodname: 'block_newgu_spdetails_get_assessments',\n        args: {\n            activetab: activetab,\n            page: page,\n            sortby: sortby,\n            sortorder: sortorder,\n            subcategory: subcategory,\n        }\n    }]);\n    promise[0].done(function(response) {\n        document.querySelector('.loader').remove();\n        let coursedata = JSON.parse(response.result);\n        Log.debug('courses:' + response.result);\n        Templates.renderForPromise('block_newgu_spdetails/' + whichTemplate, {coursedata:coursedata})\n        .then(({html, js}) => {\n            Templates.appendNodeContents(containerBlock, html, js);\n            let subCategories = document.querySelectorAll('.subcategory-row');\n            subCategoryEventHandler(subCategories);\n        }).catch((error) => displayException(error));\n    });\n};\n\nconst subCategoryEventHandler = (rows) => {\n    if (rows.length > 0) {\n        rows.forEach((element) => {\n            element.addEventListener('click', () => showSubcategoryDetails(element));\n        });\n    }\n};\n\nconst showSubcategoryDetails = (object) => {\n    let id = object.getAttribute('data-id');\n    //let subname = object.getAttribute('data-name');\n    //let course = object.getAttribute('data-course');\n    //let grade = object.getAttribute('data-grade');\n    //let weight = object.getAttribute('data-weight');\n    Log.debug('showSubcategoryDetails called with id:' + id);\n\n    if (id !== null) {\n        loadAssessments('current', 0, 'duedate', 'ASC', false, id);\n        //document.querySelector('#subcategory-details-course').innerHTML = course;\n        //document.querySelector('#subcategory-details-weight').innerHTML = weight;\n        //document.querySelector('#subcategory-details-grade').innerHTML = grade;\n        //document.querySelector('#subcategory-details-name').innerHTML = subname;\n        //document.querySelector('#subcategory-return-assessment').addEventListener('click', () => {\n        //    document.querySelector('#courses-container').classList.remove('hidden-container');\n        //    document.querySelector('#subcategory-container').classList.add('hidden-container');\n        //    document.querySelector('#subcategory_details_contents').innerHTML = \"\";\n        //});\n    }\n};\n\n/**\n * Function to bind events to tabs.\n *\n * @param {object} event\n */\nconst handleTabChange = function(event) {\n    event.preventDefault();\n\n    let currentTab = document.querySelector('#current_tab');\n    let pastTab = document.querySelector('#past_tab');\n    let isPageClicked = false;\n\n    switch(event.target) {\n        case currentTab:\n            var activetab = 'current';\n            var page = 0;\n            var sortby = 'coursetitle';\n            var sortorder = 'asc';\n\n            currentTab.classList.add('active');\n            pastTab.classList.remove('active');\n\n            loadAssessments(activetab, page, sortby, sortorder, isPageClicked);\n            break;\n        case pastTab:\n            var activetab = 'past';\n            var page = 0;\n            var sortby = 'coursetitle';\n            var sortorder = 'ASC';\n\n            currentTab.classList.remove('active');\n            pastTab.classList.add('active');\n\n            loadAssessments(activetab, page, sortby, sortorder, isPageClicked);\n            break;\n        default:\n            break;\n    }\n};\n\n\n/**\n * @constructor\n */\nexport const init = () => {\n    initCourseTabs();\n};"],"names":["loadAssessments","activetab","page","sortby","sortorder","isPageClicked","subcategory","containerBlock","document","querySelector","whichTemplate","children","length","innerHTML","insertAdjacentHTML","promise","Ajax","call","methodname","args","done","response","remove","coursedata","JSON","parse","result","Log","debug","renderForPromise","then","_ref","html","js","appendNodeContents","subCategories","querySelectorAll","subCategoryEventHandler","catch","error","rows","forEach","element","addEventListener","showSubcategoryDetails","object","id","getAttribute","handleTabChange","event","preventDefault","currentTab","pastTab","target","classList","add","triggerEl","activeElement","keyCode","hasAttribute","click"],"mappings":"+0CAyDMA,gBAAkB,SAASC,UAAWC,KAAMC,OAAQC,UAAWC,mBAAeC,mEAAc,KAC1FC,eAAiBC,SAASC,cAAc,8BAExCC,cAAgC,OAAhBJ,YAAuB,iBAAmB,oBAE1DC,eAAeI,SAASC,OAAS,IACjCL,eAAeM,UAAY,IAG/BN,eAAeO,mBAAmB,aAAa,wJAG3CC,QAAUC,KAAKC,KAAK,CAAC,CACrBC,WAAY,wCACZC,KAAM,CACFlB,UAAWA,UACXC,KAAMA,KACNC,OAAQA,OACRC,UAAWA,UACXE,YAAaA,gBAGrBS,QAAQ,GAAGK,MAAK,SAASC,UACrBb,SAASC,cAAc,WAAWa,aAC9BC,WAAaC,KAAKC,MAAMJ,SAASK,QACrCC,IAAIC,MAAM,WAAaP,SAASK,2BACtBG,iBAAiB,yBAA2BnB,cAAe,CAACa,WAAWA,aAChFO,MAAKC,WAACC,KAACA,KAADC,GAAOA,4BACAC,mBAAmB3B,eAAgByB,KAAMC,QAC/CE,cAAgB3B,SAAS4B,iBAAiB,oBAC9CC,wBAAwBF,kBACzBG,OAAOC,QAAU,2BAAiBA,aAIvCF,wBAA2BG,OACzBA,KAAK5B,OAAS,GACd4B,KAAKC,SAASC,UACVA,QAAQC,iBAAiB,SAAS,IAAMC,uBAAuBF,eAKrEE,uBAA0BC,aACxBC,GAAKD,OAAOE,aAAa,WAK7BpB,IAAIC,MAAM,yCAA2CkB,IAE1C,OAAPA,IACA9C,gBAAgB,UAAW,EAAG,UAAW,OAAO,EAAO8C,KAkBzDE,gBAAkB,SAASC,OAC7BA,MAAMC,qBAEFC,WAAa3C,SAASC,cAAc,gBACpC2C,QAAU5C,SAASC,cAAc,oBAG9BwC,MAAMI,aACJF,eACGlD,UAAY,UACZC,KAAO,EACPC,OAAS,cACTC,UAAY,MAEhB+C,WAAWG,UAAUC,IAAI,UACzBH,QAAQE,UAAUhC,OAAO,UAEzBtB,gBAAgBC,UAAWC,KAAMC,OAAQC,UAZ7B,kBAcXgD,QACGnD,UAAY,OACZC,KAAO,EACPC,OAAS,cACTC,UAAY,MAEhB+C,WAAWG,UAAUhC,OAAO,UAC5B8B,QAAQE,UAAUC,IAAI,UAEtBvD,gBAAgBC,UAAWC,KAAMC,OAAQC,UAvB7B,uBAkCJ,KA9HhBJ,gBAPgB,UACL,EACE,cACG,OACI,GAKGQ,SAAS4B,iBAAiB,uBAGlCK,SAAQe,YACnBA,UAAUb,iBAAiB,QAASK,iBACpCQ,UAAUb,iBAAiB,SAAS,SAASM,WACrCP,QAAUlC,SAASiD,cACD,KAAlBR,MAAMS,SAAkBhB,QAAQiB,aAAa,cAC7CV,MAAMC,iBACNR,QAAQkB"}